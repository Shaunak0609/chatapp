<h2>Welcome, <span th:text="${username}"></span>!</h2>

<div id="chatBox" style="border:1px solid #000; height:300px; overflow:auto;"></div>

<input type="text" id="messageInput" placeholder="Type a message"/>
<button onclick="sendMessage()">Send</button>

<!-- Hidden span to pass username to JS -->
<span id="usernameHolder" th:text="${username}" style="display:none"></span>

<!-- Logout button -->
<form action="/logout" method="get">
    <button type="submit">Logout</button>
</form>

<script>
    const username = document.getElementById("usernameHolder").innerText;

    const wsProtocol = window.location.protocol === "https:" ? "wss://" : "ws://";
    const wsUrl = wsProtocol + window.location.host + "/chat";

    let ws = null;

    function connectWebSocket() {
        ws = new WebSocket(wsUrl);

        ws.onopen = () => {
            console.log("WebSocket connected");
        };

        ws.onerror = (e) => {
            console.error("WebSocket error:", e);
        };

        ws.onmessage = (event) => {
            const chatBox = document.getElementById("chatBox");
            chatBox.innerHTML += event.data + "<br/>";
            chatBox.scrollTop = chatBox.scrollHeight;
        };
    }

    connectWebSocket();

    function sendMessage() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
            console.error("WebSocket not ready");
            return;
        }

        const input = document.getElementById("messageInput");
        if (!input.value.trim()) return;

        ws.send(input.value);
        input.value = "";
    }
</script>



